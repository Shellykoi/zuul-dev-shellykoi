# 修复登录问题指南

## 问题描述
1. 登录时显示"用户名或密码错误"
2. 404错误（资源未找到）

## 可能的原因

### 1. 服务器未重启
**问题**：UserFixer已经成功重置了密码，但服务器可能还在使用旧的数据库连接或缓存。

**解决方案**：
1. **停止当前运行的服务器**（如果正在运行）
2. **重新编译代码**：
   ```powershell
   javac -d bin -encoding UTF-8 -cp "lib\mysql-connector-j-8.0.33.jar" src\cn\edu\whut\sept\zuul\*.java
   ```
3. **重启服务器**：
   ```powershell
   java -cp "bin;lib\mysql-connector-j-8.0.33.jar" cn.edu.whut.sept.zuul.WebMain
   ```

### 2. 数据库密码验证问题
**已添加的调试信息**：
- 密码的字节数组比较
- 详细的密码匹配日志
- 输入密码和数据库密码的详细对比

**检查方法**：
1. 查看服务器控制台输出，应该能看到详细的密码比较信息
2. 检查"密码比较详情"部分的输出
3. 确认输入密码和数据库密码的字节数组是否完全一致

### 3. 404错误（静态资源）
**可能原因**：
- 文件路径问题
- 文件不存在

**检查方法**：
1. 确认 `web/` 目录下有以下文件：
   - `index.html`
   - `game.js`
   - `style.css`
2. 检查浏览器控制台的404错误，看是哪个文件找不到
3. 确认服务器启动时 `WEB_ROOT = "web"` 指向正确的目录

## 诊断步骤

### 步骤1：确认数据库中的密码
运行以下命令检查数据库中的实际密码：
```powershell
mysql -ushellykoi -p123456koiii zuul_game -e "SELECT user_id, username, password, LENGTH(password) as pwd_len FROM users WHERE username = 'koi'"
```

### 步骤2：查看服务器日志
启动服务器后，尝试登录，查看控制台输出：
- 应该看到 "=== 登录调试信息 ==="
- 检查"密码比较详情"部分
- 确认密码是否匹配

### 步骤3：测试登录API
使用PowerShell测试登录：
```powershell
$body = @{
    username = "koi"
    password = "123456"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/api/login" -Method POST -Body $body -ContentType "application/json"
```

## 已修复的问题

1. ✅ **添加了详细的密码比较调试信息**
   - 显示密码的字节数组
   - 显示equals和equalsIgnoreCase的比较结果
   - 帮助诊断密码匹配问题

2. ✅ **修复了编译错误**
   - 添加了UnsupportedEncodingException异常处理

## 下一步操作

1. **重启服务器**（最重要！）
2. **查看服务器控制台输出**，检查密码比较详情
3. **如果仍然失败**，检查数据库中的实际密码值
4. **检查404错误**，确认是哪个资源文件找不到

## 如果问题仍然存在

如果按照上述步骤操作后问题仍然存在，请提供：
1. 服务器控制台的完整输出（特别是登录调试信息部分）
2. 浏览器控制台的错误信息
3. 数据库查询结果（步骤1的输出）

